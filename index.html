<!DOCTYPE html>
<html>
<head>
  <title>Google Quiz Live</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --google-blue: #4285F4;
      --google-red: #EA4335;
      --google-yellow: #FBBC05;
      --google-green: #34A853;

      --dark-bg: #202124;
      --card-bg: #292a2d;
      --text-color: #E8EAED;
      --border-radius: 16px;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      position: relative;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 700px;
      padding: 40px;
      text-align: center;
      background: rgba(41, 42, 45, 0.95);
      border-radius: var(--border-radius);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 1;
    }

    .logo {
      width: 120px;
      margin-bottom: 20px;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    }

    h1, h2 {
      font-weight: 500;
      color: var(--google-blue);
      margin-top: 0;
      margin-bottom: 20px;
    }

    h1 { 
      font-weight: 700; 
      font-size: 2.5em;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    #connection-status {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 500;
    }

    #connection-status.connected {
      background-color: rgba(52, 168, 83, 0.2);
      color: var(--google-green);
    }

    #connection-status.disconnected {
      background-color: rgba(234, 67, 53, 0.2);
      color: var(--google-red);
    }

    #timer-display {
      font-size: 4em;
      font-weight: 700;
      color: var(--google-yellow);
      margin-top: -10px;
      margin-bottom: 30px;
      transition: color 0.5s, transform 0.3s;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    #timer-display.low-time {
      color: var(--google-red);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    #registration-container {
      margin-bottom: 30px;
    }

    #username-input {
      padding: 15px 20px;
      width: 70%;
      max-width: 300px;
      border: 2px solid #5F6368;
      background-color: rgba(60, 64, 67, 0.3);
      border-radius: 12px;
      color: var(--text-color);
      font-size: 16px;
      transition: border-color 0.3s, background-color 0.3s;
      margin-bottom: 15px;
    }

    #username-input:focus {
      outline: none;
      border-color: var(--google-blue);
      background-color: rgba(60, 64, 67, 0.5);
    }

    .btn {
      padding: 15px 30px;
      border: none;
      background: linear-gradient(135deg, var(--google-blue) 0%, #6a9cfd 100%);
      color: var(--text-color);
      font-size: 16px;
      font-weight: 500;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    #quiz-container {
      display: none;
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }

    #question-text {
      font-size: 26px;
      font-weight: 500;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 0 30px 0;
      line-height: 1.4;
    }

    #options-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .option-button {
      background: linear-gradient(135deg, #3C4043 0%, #5F6368 100%);
      border: 2px solid transparent;
      color: var(--text-color);
      font-size: 16px;
      font-weight: 500;
      padding: 18px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .option-button.correct {
      background: linear-gradient(135deg, var(--google-green) 0%, #4CAF50 100%);
      border: 2px solid var(--google-green);
      box-shadow: 0 4px 15px rgba(52, 168, 83, 0.3);
    }

    .option-button.incorrect {
      background: linear-gradient(135deg, var(--google-red) 0%, #F44336 100%);
      border: 2px solid var(--google-red);
      box-shadow: 0 4px 15px rgba(234, 67, 53, 0.3);
    }

    #leaderboard {
      width: 100%;
    }

    #leaderboard-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #leaderboard-list li {
      background: linear-gradient(135deg, var(--dark-bg) 0%, #2d2e31 100%);
      padding: 18px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 18px;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

  </style>
</head>
<body>
  <div class="container">
    <img src="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png" alt="Google Logo" class="logo">
    <h1>Google GDG Live Quiz</h1>

    <div id="connection-status" class="disconnected">Connecting to server...</div>

    <div id="registration-container">
      <input type="text" id="username-input" placeholder="Enter your name to join">
      <br>
      <button id="register-button" class="btn">Join the Quiz</button>
    </div>

    <div id="quiz-container">
      <div id="timer-display">15</div>
      <h2 id="question-text"></h2>
      <div id="options-container"></div>
    </div>

    <h2 id="leaderboard-title">Live Leaderboard</h2>
    <div id="leaderboard">
      <ul id="leaderboard-list"></ul>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" integrity="sha384-7W+qlf+Pq/GpH4I3GfKuG1fEerKJ+7FZ5eGdDCp28I2bylH6K4x08RQ5RvZXGohC" crossorigin="anonymous"></script>
  <script>
    const registrationContainer = document.getElementById('registration-container');
    const registerButton = document.getElementById('register-button');
    const usernameInput = document.getElementById('username-input');
    const leaderboardList = document.getElementById('leaderboard-list');
    const quizContainer = document.getElementById('quiz-container');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const timerDisplay = document.getElementById('timer-display');
    const connectionStatus = document.getElementById('connection-status');

    let currentUser = null;
    let socket = null;
    let timerInterval = null;

    // Connect to server
    function initializeConnection() {
      socket = io("https://gdg-on-campus-quiz.onrender.com");

      socket.on('connect', () => {
        connectionStatus.textContent = 'Connected to server';
        connectionStatus.className = 'connected';
      });

      socket.on('disconnect', () => {
        connectionStatus.textContent = 'Disconnected from server';
        connectionStatus.className = 'disconnected';
      });

      // Receive quiz updates
      socket.on('newQuestion', (data) => {
        displayQuestion(data);
      });

      socket.on('timerUpdate', (timeLeft) => {
        updateTimer(timeLeft);
      });

      socket.on('updateLeaderboard', (users) => {
        updateLeaderboard(users);
      });

      socket.on('answerResult', ({ isCorrect, correctAnswer }) => {
        showAnswerResult(isCorrect, correctAnswer);
      });
    }

    function displayQuestion(questionData) {
      clearInterval(timerInterval); // stop previous timer
      questionText.textContent = `Question ${questionData.questionNumber}: ${questionData.question}`;
      optionsContainer.innerHTML = '';

      questionData.options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'option-button';
        btn.textContent = option;
        btn.addEventListener('click', () => submitAnswer(option));
        optionsContainer.appendChild(btn);
      });

      // Start countdown
      let timeLeft = questionData.time || 15; // default 15s
      updateTimer(timeLeft);
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimer(timeLeft);
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);
        }
      }, 1000);
    }

    function updateTimer(timeLeft) {
      timerDisplay.textContent = timeLeft;
      if (timeLeft <= 5) {
        timerDisplay.classList.add('low-time');
      } else {
        timerDisplay.classList.remove('low-time');
      }
    }

    function submitAnswer(answer) {
      Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);
      if (socket) socket.emit('submitAnswer', answer);
    }

    function showAnswerResult(isCorrect, correctAnswer) {
      Array.from(optionsContainer.children).forEach(btn => {
        if (btn.textContent === correctAnswer) btn.classList.add('correct');
        else if (btn.disabled) btn.classList.add('incorrect');
      });
    }

    function updateLeaderboard(users) {
      leaderboardList.innerHTML = '';
      users.sort((a, b) => b.score - a.score).forEach((user, i) => {
        const li = document.createElement('li');
        li.textContent = `${i + 1}. ${user.name}: ${user.score}`;
        leaderboardList.appendChild(li);
      });
    }

    registerButton.addEventListener('click', () => {
      const name = usernameInput.value.trim();
      if (!name) return alert('Enter your name!');
      currentUser = { name };
      registrationContainer.style.display = 'none';
      quizContainer.style.display = 'block';
      if (socket) socket.emit('register', name);
    });

    usernameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') registerButton.click();
    });

    document.addEventListener('DOMContentLoaded', initializeConnection);
  </script>
</body>
</html>
